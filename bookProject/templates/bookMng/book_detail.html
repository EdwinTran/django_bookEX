{% extends "base.html" %}
{% load static %}

{% block title %}
   Book Detail
{% endblock title %}


{% block sidenav %}
    {% for item in item_list %}
        <li>
            <a href="{{ item.link }}"> {{ item.item }} </a>
        </li>
    {% endfor %}
{% endblock sidenav %}

{% block content %}
<!--if statement to give thanks if message was sent-->
{% if message_name %}
<h2 align="center">Thanks {{ message_name }}!</h2>
    <p align="center">We have received your email and will respond shortly...</p>
    <button align="center" onclick="history.back()"> Go back </button>
<!--else, show book detail and message form-->
{% else %}
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo03" aria-controls="navbarTogglerDemo03" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <a class="navbar-brand" href="/">Book Exchange</a>

  <div class="collapse navbar-collapse" id="navbarTogglerDemo03">
    <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
      <!-- ## Jason START ## -->
      <li class="nav-item">
        <a class="nav-link" href="/displaybooks">Display Books</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/postbook">Post Books</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/displayrequest">Requested Books</a>
      </li>
      <!-- ## Jason END ## -->
    </ul>
    {% if user.is_authenticated %}
      <a class="nav-link" href="/mybooks">My Books</a>
      <a href="{% url 'logout' %}">Logout</a>
    {% else %}
    <a class="nav-link" href="{% url 'login' %}">Login</a>
    <a class="nav-link" href="{% url 'signup' %}">Sign Up</a>
    {% endif %}
  </div>
</nav>
<h1 align="center"> {{ book.name }} Page </h1>
<table align="center" border="2" width="500">
        <tr>
            <th>
                Name
            </th>
            <th>
                Price
            </th>
            <th>
                User
            </th>
            <th>
                Picture
            </th>
        </tr>
        <tr>
            <td>
                {{ book.name }}
            </td>
            <td>
                {{ book.price }}
            </td>
            <td>
                {{ book.user_name }}
            </td>
            <td>
                <img src="{% static book.pic_path %}" width="40" height="40">
            </td>
        </tr>
</table>

{% if book.username != request.user %}
    <h2 align="center">Have the same book?<br>Write your own review!</h2>
    <form action="" enctype="multipart/form-data" method="post" novalidate>
        <table align="center">
            {{ form.as_table }}
            <tr>
                <td colspan="2">
                    <input type="submit" value="Submit">
                </td>
            </tr>
        </table>
        {% csrf_token %}
    </form>
{% endif %}
{% for review in book.review_set.all %}
    <p align="center">
        <b>{{ review.rating }}/5</b> <br>
        {{ review.username }} <br>
        Reviewed on {{ review.publishdate }} <br>
        <b>{{ review.title }}</b> <br>
        {{ review.description }} <br>
    </p>
{% endfor %}

<!--Send Message Form-->
<h2 align="center"> Have a question? <br> Send a message </h2>

<form action="{% url 'contact' %}" method="post">
    {% csrf_token %}
    <input type="hidden" name="message-book" value="{{ book.name }}">
    <input type="hidden" name="post-username" value="{{ book.user_name }}">
    <table align="center">
    <tr>
        <td>
            <input type="text" name="message-name" class="form-control mb-30" placeholder="Your Name">
        </td>
    </tr>
    <tr>
        <td>
            <input type="email" name="message-email" class="form-control mb-30" placeholder="Your Email">
        </td>
    </tr>
    <tr>
        <td>
            <textarea name="message" class="form-control mb-30" placeholder="Your Message"></textarea>
        </td>
    </tr>
    <tr>
        <td>
            <button onclick="this.disabled=true;this.value='Sending...'; this.form.submit();"> Send Message </button>
        </td>
    </tr>
    </table>
</form>
{% endif %}
{% endblock content %}